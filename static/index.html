<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI è™›æ“¬å ´æ™¯äº’å‹•ç³»çµ±</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <!-- Main Container -->
        <div class="scene-section">
            <!-- Scene Display -->
            <div class="scene-display"
                 :style="{ backgroundImage: `url(${currentSceneBackground})` }">
                <div class="scene-overlay">
                    <img :src="currentEmojiPath"
                         :alt="currentEmoji"
                         class="emoji-display"
                         v-if="currentEmoji">
                </div>
            </div>

            <!-- Scene Info -->
            <div class="scene-info" v-if="currentScene">
                <div class="scene-name">
                    {{ currentScene.icon }} {{ currentScene.name }}
                </div>
                <div class="scene-description">
                    {{ currentScene.description }}
                </div>
            </div>

            <!-- Status Values -->
            <div class="status-container">
                <div class="status-title">â­ è§’è‰²ç‹€æ…‹</div>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">ğŸ½ï¸ é£¢é¤“å€¼</div>
                        <div class="status-bar-container">
                            <div class="status-bar-text">{{ status.hunger }}</div>
                            <div :class="['status-bar', 'hunger', { low: status.hunger < 30 }]"
                                 :style="{ width: status.hunger + '%' }">
                            </div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">âš¡ ç²¾ç¥å€¼</div>
                        <div class="status-bar-container">
                            <div class="status-bar-text">{{ status.energy }}</div>
                            <div :class="['status-bar', 'energy', { low: status.energy < 30 }]"
                                 :style="{ width: status.energy + '%' }">
                            </div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">ğŸ˜Š å¿«æ¨‚å€¼</div>
                        <div class="status-bar-container">
                            <div class="status-bar-text">{{ status.happiness }}</div>
                            <div :class="['status-bar', 'happiness', { low: status.happiness < 30 }]"
                                 :style="{ width: status.happiness + '%' }">
                            </div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">ğŸ’š å¥åº·å€¼</div>
                        <div class="status-bar-container">
                            <div class="status-bar-text">{{ status.health }}</div>
                            <div :class="['status-bar', 'health', { low: status.health < 30 }]"
                                 :style="{ width: status.health + '%' }">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scene Selector -->
            <div class="scene-selector">
                <button v-for="scene in scenes"
                        :key="scene.id"
                        @click="setScene(scene.id)"
                        :class="['scene-button', { active: currentScene && currentScene.id === scene.id }]">
                    <span>{{ scene.icon }}</span>
                    <span>{{ scene.name }}</span>
                </button>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="chat-section">
            <!-- Chat Header -->
            <div class="chat-header">
                <h2 class="chat-title">å°è©±äº’å‹•</h2>
                <button @click="clearHistory" class="clear-history-btn">
                    æ¸…é™¤æ­·å²
                </button>
            </div>

            <!-- Error Message -->
            <div v-if="errorMessage" class="error-message">
                {{ errorMessage }}
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" ref="chatMessages">
                <!-- Welcome Message -->
                <div v-if="messages.length === 0" class="message assistant">
                    <div class="message-content">
                        æ­¡è¿ä¾†åˆ° AI è™›æ“¬å ´æ™¯äº’å‹•ç³»çµ±ï¼æˆ‘æ˜¯æ‚¨çš„è™›æ“¬åŠ©æ‰‹ï¼Œå¯ä»¥åœ¨ä¸åŒå ´æ™¯ä¸­ç‚ºæ‚¨æä¾›å”åŠ©ã€‚
                        <br><br>
                        æ‚¨å¯ä»¥ï¼š
                        <br>â€¢ èˆ‡æˆ‘è‡ªç”±å°è©±ï¼Œæˆ‘æœƒæ ¹æ“šæƒ…å¢ƒçµ¦äºˆå›æ‡‰
                        <br>â€¢ é»æ“Šä¸‹æ–¹æŒ‰éˆ•åˆ‡æ›å ´æ™¯
                        <br>â€¢ åœ¨ MCP å·¥ä½œå®¤ä½¿ç”¨å„ç¨®é–‹ç™¼å·¥å…·
                        <br><br>
                        è«‹å•æœ‰ä»€éº¼æˆ‘å¯ä»¥å¹«åŠ©æ‚¨çš„å—ï¼Ÿ
                    </div>
                </div>

                <!-- Message List -->
                <div v-for="(message, index) in messages"
                     :key="index"
                     :class="['message', message.role]">
                    <div class="message-content">
                        {{ message.content }}
                    </div>

                    <!-- MCP Output Display -->
                    <div v-if="message.mcpOutput" class="mcp-output">
                        <div class="mcp-output-title">
                            ğŸ”§ MCP å·¥å…·åŸ·è¡Œçµæœ
                        </div>
                        <div class="mcp-output-content">
                            <strong>å·¥å…·:</strong> {{ message.mcpOutput.tool_used }}
                            <br>
                            <strong>ç‹€æ…‹:</strong> {{ message.mcpOutput.success ? 'æˆåŠŸ âœ“' : 'å¤±æ•— âœ—' }}
                            <br>
                            <strong>æ™‚é–“:</strong> {{ message.mcpOutput.timestamp }}
                            <br><br>
                            <strong>è¼¸å‡º:</strong>
                            <br>{{ message.mcpOutput.output }}
                        </div>
                    </div>

                    <div class="message-meta">
                        {{ message.timestamp }}
                    </div>
                </div>

                <!-- Loading Indicator -->
                <div v-if="isLoading" class="message assistant">
                    <div class="loading">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input
                        type="text"
                        v-model="inputMessage"
                        @keypress="handleKeyPress"
                        :disabled="isLoading"
                        placeholder="è¼¸å…¥è¨Šæ¯... (Enter ç™¼é€)"
                        class="chat-input">
                    <button
                        @click="sendMessage"
                        :disabled="isLoading || !inputMessage.trim()"
                        class="send-button">
                        ç™¼é€
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Vue App -->
    <script src="/static/js/app.js"></script>
</body>
</html>
